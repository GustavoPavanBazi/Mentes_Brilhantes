<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentes Brilhantes</title>
    <link rel="icon" type="image/x-icon" href="../img/LogoMB.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/adm_especialista.css">
</head>
<body>
  
<!-- ========== ONBOARDING MODAL ========== -->
<div id="onboardingModal" class="onboarding-modal">
    <div class="onboarding-content">
        <button class="onboarding-close" id="closeOnboarding" style="display: none;">
            <i class="fas fa-times"></i>
        </button>

        <div class="onboarding-progress">
            <div class="onboarding-progress-bar" id="onboardingProgress"></div>
        </div>
        <div class="onboarding-step-indicator">
            <span id="currentStep">1</span> de 5
        </div>

        <div class="onboarding-step active" data-step="1">
            <div class="onboarding-icon">
                <i class="fas fa-hand-sparkles"></i>
            </div>
            <h2 class="onboarding-title">Bem-vindo ao Mentes Brilhantes!</h2>
            <p class="onboarding-description">
                Sua plataforma completa para conectar especialistas em autismo com famílias que precisam de suporte profissional. Vamos guiá-lo em uma rápida introdução.
            </p>
            <div class="onboarding-illustration">
                <i class="fas fa-users" style="font-size: 4rem; color: var(--primary-blue); opacity: 0.3;"></i>
            </div>
        </div>

        <div class="onboarding-step" data-step="2">
            <div class="onboarding-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <h2 class="onboarding-title">Gerenciamento Simplificado</h2>
            <p class="onboarding-description">
                Gerencie suas consultas, pacientes, horários e recebimentos em um único lugar. Organize sua agenda de forma profissional e eficiente.
            </p>
            <ul class="onboarding-features">
                <li><i class="fas fa-check-circle"></i> Agenda online integrada</li>
                <li><i class="fas fa-check-circle"></i> Perfil de pacientes completo</li>
                <li><i class="fas fa-check-circle"></i> Notificações automáticas</li>
                <li><i class="fas fa-check-circle"></i> Controle financeiro em tempo real</li>
            </ul>
        </div>

        <div class="onboarding-step" data-step="3">
            <div class="onboarding-icon">
                <i class="fas fa-video"></i>
            </div>
            <h2 class="onboarding-title">Consultas Online e Presenciais</h2>
            <p class="onboarding-description">
                Ofereça atendimento presencial ou online através da nossa plataforma. Amplie seu alcance e atenda famílias de todo o Brasil.
            </p>
            <div class="onboarding-highlight">
                <i class="fas fa-star"></i>
                <p>Famílias podem encontrar você facilmente através do nosso sistema de busca personalizado</p>
            </div>
        </div>

        <div class="onboarding-step" data-step="4">
            <div class="onboarding-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h2 class="onboarding-title">Compartilhe Conteúdos</h2>
            <p class="onboarding-description">
                Publique materiais educativos, vídeos e recursos para seus pacientes. Fortaleça o vínculo terapêutico além das consultas.
            </p>
            <ul class="onboarding-features">
                <li><i class="fas fa-check-circle"></i> Biblioteca de recursos personalizável</li>
                <li><i class="fas fa-check-circle"></i> Upload de vídeos e documentos</li>
                <li><i class="fas fa-check-circle"></i> Materiais organizados por categoria</li>
            </ul>
        </div>

        <div class="onboarding-step" data-step="5">
            <div class="onboarding-icon">
                <i class="fas fa-file-contract"></i>
            </div>
            <h2 class="onboarding-title">Termos de Uso e Comissão</h2>
            <p class="onboarding-description">
                Antes de começar, é importante conhecer nossos termos de serviço e modelo de negócio.
            </p>
            
            <div class="onboarding-commission-notice">
                <div class="commission-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="commission-info">
                    <h4>Taxa de Serviço da Plataforma</h4>
                    <p>
                        Para manter a plataforma funcionando e continuar melhorando nossos serviços, 
                        <strong>cobramos uma taxa de 10% sobre o valor de cada consulta realizada</strong> 
                        através do Mentes Brilhantes.
                    </p>
                    <p class="commission-detail">
                        <i class="fas fa-calculator"></i> 
                        Exemplo: Consulta de R$ 200,00 → Você recebe R$ 180,00
                    </p>
                </div>
            </div>

            <div class="onboarding-terms">
                <label class="onboarding-checkbox-container">
                    <input type="checkbox" id="acceptTerms" required>
                    <span class="checkmark"></span>
                    <span class="checkbox-label">
                        Li e concordo com os 
                        <a href="../html/termos-de-uso.html" target="_blank">Termos de Uso</a> 
                        e 
                        <a href="../html/politica-privacidade.html" target="_blank">Política de Privacidade</a>
                    </span>
                </label>
                
                <label class="onboarding-checkbox-container">
                    <input type="checkbox" id="acceptCommission" required>
                    <span class="checkmark"></span>
                    <span class="checkbox-label">
                        Estou ciente e concordo com a taxa de serviço de 10% sobre cada consulta
                    </span>
                </label>
            </div>

            <p class="onboarding-terms-note">
                <i class="fas fa-shield-alt"></i>
                Seus dados estão protegidos e seguimos a LGPD rigorosamente
            </p>
        </div>

        <div class="onboarding-navigation">
            <button class="btn-onboarding btn-onboarding-secondary" id="prevStep" style="visibility: hidden;">
                <i class="fas fa-arrow-left"></i> Anterior
            </button>
            <button class="btn-onboarding btn-onboarding-primary" id="nextStep">
                Próximo <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn-onboarding btn-onboarding-primary" id="finishOnboarding" style="display: none;">
                Começar a Usar <i class="fas fa-check"></i>
            </button>
        </div>
    </div>
</div>

<!-- Header -->
<header class="header">
    <div class="header-container">
        <div class="logo-section">
            <img src="../img/LogoMB.png" alt="Logo" style="width: 32px; height: 32px;">
            <span>Mentes Brilhantes</span>
        </div>
        <nav class="header-nav">
            <div class="notifications">
                <i class="far fa-bell"></i>
                <span class="notification-badge">3</span>
            </div>
            <div class="user-profile" onclick="toggleUserDropdown()">
                <div class="user-avatar" id="headerAvatar"></div>
                <div class="user-info">
                    <h4 id="headerUserName">Carregando...</h4>
                    <p>Especialista</p>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" class="user-dropdown-item" onclick="showSection('perfil')">
                        <i class="fas fa-user"></i> Meu Perfil
                    </a>
                    <a href="#" class="user-dropdown-item" onclick="showSection('configuracoes')">
                        <i class="fas fa-cog"></i> Configurações
                    </a>
                    <a href="../php/logout.php" class="user-dropdown-item">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </a>
                </div>
            </div>
        </nav>
    </div>
</header>

<!-- Layout Principal -->
<div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <nav>
            <div class="nav-section">
                <p class="nav-title">Menu Principal</p>
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('consultas')">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Consultas</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('pacientes')">
                    <i class="fas fa-users"></i>
                    <span>Pacientes</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('avaliacoes')">
                    <i class="fas fa-star"></i>
                    <span>Avaliações</span>
                </a>
            </div>
            <div class="nav-section">
                <p class="nav-title">Gestão</p>
                <a href="#" class="nav-item" onclick="showSection('conteudos')">
                    <i class="fas fa-book"></i>
                    <span>Conteúdos</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('agenda')">
                    <i class="fas fa-clock"></i>
                    <span>Agenda</span>
                </a>
            </div>
            <div class="nav-section">
                <p class="nav-title">Configurações</p>
                <a href="#" class="nav-item" onclick="showSection('perfil')">
                    <i class="fas fa-user"></i>
                    <span>Meu Perfil</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('configuracoes')">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
                <a href="../php/logout.php" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="main-content">
        <!-- Seção Dashboard -->
        <section id="dashboard" class="section active">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <p class="page-subtitle">Visão geral das suas atividades</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Consultas do Mês</span>
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="totalConsultas">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 20%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Pacientes Ativos</span>
                        <div class="stat-icon success">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="totalPacientes">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 12%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Receita Mensal</span>
                        <div class="stat-icon warning">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="receitaMensal">R$ 0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 5%
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Próximas Consultas</h2>
                    <button class="btn btn-primary btn-sm" onclick="showSection('consultas')">
                        Ver Todas
                    </button>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Paciente</th>
                                    <th>Data/Hora</th>
                                    <th>Tipo</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardConsultasTable">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 2rem;">
                                        <i class="fas fa-calendar-alt" style="font-size: 2rem; color: var(--text-medium); margin-bottom: 1rem;"></i>
                                        <p style="color: var(--text-medium);">Nenhuma consulta agendada</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Consultas -->
        <section id="consultas" class="section">
            <div class="page-header">
                <h1 class="page-title">Consultas</h1>
                <p class="page-subtitle">Gerencie suas consultas agendadas</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Filtros</span>
                </div>
                <div class="card-content">
                    <div class="filter-panel">
                        <div class="filter-grid">
                            <div class="form-group">
                                <label>Status</label>
                                <select id="filterStatus" onchange="applyFilters()">
                                    <option value="">Todos</option>
                                    <option value="Confirmada">Confirmada</option>
                                    <option value="Pendente">Pendente</option>
                                    <option value="Cancelada">Cancelada</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tipo</label>
                                <select id="filterTipo" onchange="applyFilters()">
                                    <option value="">Todos</option>
                                    <option value="Presencial">Presencial</option>
                                    <option value="Online">Online</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Data Inicial</label>
                                <input type="date" id="filterDataInicio" onchange="applyFilters()">
                            </div>
                            <div class="form-group">
                                <label>Data Final</label>
                                <input type="date" id="filterDataFim" onchange="applyFilters()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Todas as Consultas</span>
                    <div class="btn-group">
                        <button class="btn btn-outline" onclick="exportConsultations()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn btn-primary" onclick="showModal('addAppointmentModal')">
                            <i class="fas fa-plus"></i> Nova Consulta
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Paciente</th>
                                    <th>Data/Hora</th>
                                    <th>Tipo</th>
                                    <th>Status</th>
                                    <th>Valor</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="consultasTable">
                                <tr>
                                    <td colspan="7">
                                        <div class="empty-state">
                                            <i class="fas fa-calendar-alt"></i>
                                            <h3>Nenhuma consulta encontrada</h3>
                                            <p>Adicione uma nova consulta para começar.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Pacientes -->
        <section id="pacientes" class="section">
            <div class="page-header">
                <h1 class="page-title">Pacientes</h1>
                <p class="page-subtitle">Gerencie seus pacientes</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Buscar Paciente</span>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <input type="text" id="searchPaciente" placeholder="Digite o nome do paciente..." onkeyup="searchPatients()">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Lista de Pacientes</span>
                    <div class="btn-group">
                        <button class="btn btn-outline" onclick="exportPatients()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn btn-primary" onclick="showModal('addPatientModal')">
                            <i class="fas fa-user-plus"></i> Novo Paciente
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Idade</th>
                                    <th>Responsável</th>
                                    <th>Telefone</th>
                                    <th>Última Consulta</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="pacientesTable">
                                <tr>
                                    <td colspan="8">
                                        <div class="empty-state">
                                            <i class="fas fa-users"></i>
                                            <h3>Nenhum paciente cadastrado</h3>
                                            <p>Adicione um novo paciente para começar.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Avaliações -->
        <section id="avaliacoes" class="section">
            <div class="page-header">
                <h1 class="page-title">Avaliações</h1>
                <p class="page-subtitle">Veja o feedback dos seus pacientes</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Avaliação Média</span>
                        <div class="stat-icon warning">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <div class="stat-number">4.8</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Excelente
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Total de Avaliações</span>
                        <div class="stat-icon primary">
                            <i class="fas fa-comments"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="totalAvaliacoes">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Este mês
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Últimas Avaliações</span>
                </div>
                <div class="card-content" id="avaliacoesContent">
                    <div class="empty-state">
                        <i class="fas fa-star"></i>
                        <h3>Nenhuma avaliação ainda</h3>
                        <p>As avaliações dos pacientes aparecerão aqui.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Conteúdos -->
        <section id="conteudos" class="section">
            <div class="page-header">
                <h1 class="page-title">Conteúdos Educativos</h1>
                <p class="page-subtitle">Gerencie materiais e recursos para seus pacientes</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Meus Conteúdos</span>
                    <button class="btn btn-primary" onclick="showModal('addContentModal')">
                        <i class="fas fa-plus"></i> Novo Conteúdo
                    </button>
                </div>
                <div class="card-content" id="conteudosGrid">
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <h3>Nenhum conteúdo cadastrado</h3>
                        <p>Adicione materiais educativos para seus pacientes.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Agenda -->
        <section id="agenda" class="section">
            <div class="page-header">
                <h1 class="page-title">Minha Agenda</h1>
                <p class="page-subtitle">Visualize e gerencie sua disponibilidade</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Configurar Horários</span>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label>Dia da Semana</label>
                        <select id="agendaDia">
                            <option>Segunda-feira</option>
                            <option>Terça-feira</option>
                            <option>Quarta-feira</option>
                            <option>Quinta-feira</option>
                            <option>Sexta-feira</option>
                            <option>Sábado</option>
                            <option>Domingo</option>
                        </select>
                    </div>
                    <div class="filter-grid">
                        <div class="form-group">
                            <label>Horário Início</label>
                            <input type="time" id="agendaInicio" value="09:00">
                        </div>
                        <div class="form-group">
                            <label>Horário Fim</label>
                            <input type="time" id="agendaFim" value="18:00">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveAgenda()">
                        <i class="fas fa-save"></i> Salvar Horário
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Horários Configurados</span>
                </div>
                <div class="card-content" id="agendaList">
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>Nenhum horário configurado</h3>
                        <p>Configure seus horários de atendimento.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Perfil -->
        <section id="perfil" class="section">
            <div class="page-header">
                <h1 class="page-title">Meu Perfil</h1>
                <p class="page-subtitle">Visualize e edite suas informações profissionais</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Informações do Perfil</h2>
                    <button class="btn btn-primary" onclick="openEditModal()">
                        <i class="fas fa-edit"></i> Editar Perfil
                    </button>
                </div>
                <div class="card-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div id="profileAvatarLarge" style="width: 150px; height: 150px; margin: 0 auto 1rem; border-radius: 50%; overflow: hidden; border: 4px solid var(--primary-blue);"></div>
                        <h2 id="profileName" style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem;">Carregando...</h2>
                        <p id="profileFormacao" style="color: var(--text-medium); font-size: 1rem;">Carregando...</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div class="info-group">
                            <div class="info-label"><i class="fas fa-envelope"></i> E-mail</div>
                            <div class="info-value" id="profileEmail">Carregando...</div>
                        </div>
                        <div class="info-group">
                            <div class="info-label"><i class="fas fa-id-card"></i> CPF</div>
                            <div class="info-value" id="profileCPF">Carregando...</div>
                        </div>
                        <div class="info-group">
                            <div class="info-label"><i class="fas fa-calendar"></i> Data de Nascimento</div>
                            <div class="info-value" id="profileDataNascimento">Carregando...</div>
                        </div>
                        <div class="info-group">
                            <div class="info-label"><i class="fas fa-venus-mars"></i> Sexo</div>
                            <div class="info-value" id="profileSexo">Carregando...</div>
                        </div>
                    </div>

                    <div class="info-group" style="margin-top: 1.5rem;">
                        <div class="info-label"><i class="fas fa-info-circle"></i> Sobre Mim</div>
                        <div class="info-value" id="profileDescricao" style="white-space: pre-wrap;">Carregando...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Configurações -->
        <section id="configuracoes" class="section">
            <div class="page-header">
                <h1 class="page-title">Configurações</h1>
                <p class="page-subtitle">Gerencie suas preferências</p>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Preferências da Conta</h2>
                </div>
                <div class="card-content">
                    <p>Configurações em desenvolvimento...</p>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Modal de Edição de Perfil -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeEditModal()">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Editar Perfil</h3>
        </div>
        <div class="modal-body">
            <form id="editProfileForm">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" id="editNome" class="form-input disabled" required readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">E-mail</label>
                    <input type="email" id="editEmail" class="form-input disabled" required readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">CPF</label>
                    <input type="text" id="editCPF" class="form-input disabled" required maxlength="14" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Data de Nascimento</label>
                    <input type="date" id="editDataNascimento" class="form-input disabled" required readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Sexo</label>
                    <select id="editSexo" class="form-select disabled" required disabled>
                        <option value="">Selecione</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Formação</label>
                    <input type="text" id="editFormacao" class="form-input disabled" required readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Sobre Mim (mínimo 50 caracteres)</label>
                    <textarea id="editDescricao" class="form-textarea" rows="5" required minlength="50"></textarea>
                    <small style="color: var(--text-medium);">
                        <span id="charCount">0</span>/50 caracteres mínimos
                    </small>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
            <button type="submit" form="editProfileForm" class="btn btn-primary">
                <i class="fas fa-save"></i> Salvar Alterações
            </button>
        </div>
    </div>
</div>

<!-- Modal Nova Consulta -->
<div class="modal" id="addAppointmentModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('addAppointmentModal')">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Nova Consulta</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Paciente</label>
                <select id="consultaPaciente">
                    <option value="">Selecione um paciente</option>
                </select>
            </div>
            <div class="form-group">
                <label>Data e Hora</label>
                <input type="datetime-local" id="consultaDataHora">
            </div>
            <div class="form-group">
                <label>Tipo</label>
                <select id="consultaTipo">
                    <option>Presencial</option>
                    <option>Online</option>
                </select>
            </div>
            <div class="form-group">
                <label>Valor (R$)</label>
                <input type="number" id="consultaValor" value="280" step="10">
            </div>
            <div class="form-group">
                <label>Observações</label>
                <textarea id="consultaObs" placeholder="Observações adicionais..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('addAppointmentModal')">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-primary" onclick="addAppointment()">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal Novo Paciente -->
<div class="modal" id="addPatientModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('addPatientModal')">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Novo Paciente</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Nome Completo</label>
                <input type="text" id="pacienteNome" placeholder="Nome do paciente">
            </div>
            <div class="form-group">
                <label>Data de Nascimento</label>
                <input type="date" id="pacienteDataNasc">
            </div>
            <div class="form-group">
                <label>Nome do Responsável</label>
                <input type="text" id="pacienteResponsavel" placeholder="Nome do responsável">
            </div>
            <div class="form-group">
                <label>Telefone</label>
                <input type="tel" id="pacienteTelefone" placeholder="(11) 98765-4321">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="pacienteEmail" placeholder="email@exemplo.com">
            </div>
            <div class="form-group">
                <label>Observações</label>
                <textarea id="pacienteObs" placeholder="Informações relevantes sobre o paciente..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('addPatientModal')">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-primary" onclick="addPatient()">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal Visualizar Consulta -->
<div class="modal" id="viewAppointmentModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('viewAppointmentModal')">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Detalhes da Consulta</h3>
        </div>
        <div class="modal-body" id="appointmentDetails"></div>
    </div>
</div>

<!-- Modal Visualizar Paciente -->
<div class="modal" id="viewPatientModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('viewPatientModal')">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Detalhes do Paciente</h3>
        </div>
        <div class="modal-body" id="patientDetails"></div>
    </div>
</div>

<!-- Modal Novo Conteúdo -->
<div class="modal" id="addContentModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('addContentModal')">
            <i class="fas fa-times"></i>
        </button>
        <div class="modal-header">
            <h3 class="modal-title">Novo Conteúdo</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Título</label>
                <input type="text" id="contentTitulo" placeholder="Título do conteúdo">
            </div>
            <div class="form-group">
                <label>Tipo</label>
                <select id="contentTipo">
                    <option>Artigo</option>
                    <option>Vídeo</option>
                    <option>PDF</option>
                    <option>Link</option>
                </select>
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea id="contentDesc" placeholder="Descrição do conteúdo..."></textarea>
            </div>
            <div class="form-group">
                <label>URL/Link</label>
                <input type="url" id="contentUrl" placeholder="https://...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('addContentModal')">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-primary" onclick="addContent()">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
    </div>
</div>

<!-- Toast de Notificação -->
<div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage"></span>
</div>

<script>
// ============= VARIÁVEIS GLOBAIS =============
let especialistaData = {};
let consultas = [];
let pacientes = [];
let avaliacoes = [];
let conteudos = [];
let horarios = [];

// ============= ONBOARDING =============
document.addEventListener('DOMContentLoaded', function() {
    initOnboarding();
    carregarDadosEspecialista();
    carregarDadosSimulados();
    
    // Event listeners
    const descricaoTextarea = document.getElementById('editDescricao');
    if (descricaoTextarea) {
        descricaoTextarea.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });
    }

    const cpfInput = document.getElementById('editCPF');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            }
        });
    }

    document.getElementById('editProfileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        salvarPerfil();
    });
});

function initOnboarding() {
    const modal = document.getElementById('onboardingModal');
    const steps = document.querySelectorAll('.onboarding-step');
    const progressBar = document.getElementById('onboardingProgress');
    const currentStepText = document.getElementById('currentStep');
    const nextBtn = document.getElementById('nextStep');
    const prevBtn = document.getElementById('prevStep');
    const finishBtn = document.getElementById('finishOnboarding');
    const closeBtn = document.getElementById('closeOnboarding');
    const acceptTerms = document.getElementById('acceptTerms');
    const acceptCommission = document.getElementById('acceptCommission');
    
    let currentStep = 1;
    const totalSteps = 5;

    const hasSeenOnboarding = localStorage.getItem('hasSeenOnboarding');
    
    if (!hasSeenOnboarding) {
        setTimeout(() => {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }, 500);
    }

    function updateProgress() {
        const progress = (currentStep / totalSteps) * 100;
        progressBar.style.width = progress + '%';
        currentStepText.textContent = currentStep;
    }

    function showStep(stepNumber) {
        steps.forEach(step => step.classList.remove('active'));
        
        const activeStep = document.querySelector(`[data-step="${stepNumber}"]`);
        if (activeStep) activeStep.classList.add('active');

        prevBtn.style.visibility = stepNumber === 1 ? 'hidden' : 'visible';

        if (stepNumber === totalSteps) {
            nextBtn.style.display = 'none';
            finishBtn.style.display = 'inline-flex';
        } else {
            nextBtn.style.display = 'inline-flex';
            finishBtn.style.display = 'none';
        }

        updateProgress();
    }

    nextBtn.addEventListener('click', function() {
        if (currentStep < totalSteps) {
            currentStep++;
            showStep(currentStep);
        }
    });

    prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    });

    finishBtn.addEventListener('click', function() {
        if (!acceptTerms.checked || !acceptCommission.checked) {
            showToast('error', 'Por favor, aceite os termos e a taxa de serviço para continuar');
            const termsContainer = document.querySelector('.onboarding-terms');
            termsContainer.style.animation = 'shake 0.5s';
            setTimeout(() => termsContainer.style.animation = '', 500);
            return;
        }

        localStorage.setItem('hasSeenOnboarding', 'true');
        localStorage.setItem('acceptedTermsDate', new Date().toISOString());
        closeOnboardingModal();
        showToast('success', 'Bem-vindo ao Mentes Brilhantes! 🎉');
    });

    closeBtn.addEventListener('click', function() {
        if (confirm('Deseja fechar o tutorial?')) closeOnboardingModal();
    });

    function closeOnboardingModal() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    modal.addEventListener('click', function(e) {
        if (e.target === modal) closeBtn.click();
    });

    showStep(currentStep);

    window.restartOnboarding = function() {
        localStorage.removeItem('hasSeenOnboarding');
        currentStep = 1;
        showStep(currentStep);
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    };
}

// ============= CARREGAR DADOS DO BANCO =============
function carregarDadosEspecialista() {
    fetch('../php/buscar_dados_especialista.php')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                especialistaData = data;
                preencherDadosPerfil(data);
            } else {
                showToast('error', data.message || 'Erro ao carregar dados');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            showToast('error', 'Erro ao carregar dados do perfil');
        });
}

function preencherDadosPerfil(data) {
    document.getElementById('headerUserName').textContent = `${data.tratamento} ${data.nome.split(' ')[0]}`;
    
    const headerAvatar = document.getElementById('headerAvatar');
    if (data.perfil && data.perfil.trim() !== '') {
        headerAvatar.innerHTML = `<img src="../${data.perfil}" alt="Foto de perfil" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
    } else {
        headerAvatar.textContent = data.iniciais;
    }

    const profileAvatarLarge = document.getElementById('profileAvatarLarge');
    if (data.perfil && data.perfil.trim() !== '') {
        profileAvatarLarge.innerHTML = `<img src="../${data.perfil}" alt="Foto de perfil" style="width: 100%; height: 100%; object-fit: cover;">`;
    } else {
        profileAvatarLarge.innerHTML = `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary-blue), var(--primary-green)); display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; font-weight: bold;">${data.iniciais}</div>`;
    }

    document.getElementById('profileName').textContent = `${data.tratamento} ${data.nome}`;
    document.getElementById('profileFormacao').textContent = data.formacao;
    document.getElementById('profileEmail').textContent = data.email;
    document.getElementById('profileCPF').textContent = formatarCPF(data.cpf);
    document.getElementById('profileDataNascimento').textContent = `${data.data_nascimento_formatada} (${data.idade} anos)`;
    document.getElementById('profileSexo').textContent = data.sexo;
    document.getElementById('profileDescricao').textContent = data.descricao;
}

// ============= MODAL DE PERFIL =============
function openEditModal() {
    document.getElementById('editNome').value = especialistaData.nome;
    document.getElementById('editEmail').value = especialistaData.email;
    document.getElementById('editCPF').value = formatarCPF(especialistaData.cpf);
    document.getElementById('editDataNascimento').value = especialistaData.data_nascimento;
    document.getElementById('editSexo').value = especialistaData.sexo;
    document.getElementById('editFormacao').value = especialistaData.formacao;
    document.getElementById('editDescricao').value = especialistaData.descricao;
    document.getElementById('charCount').textContent = especialistaData.descricao.length;
    
    document.getElementById('editModal').classList.add('show');
}

function closeEditModal() {
    document.getElementById('editModal').classList.remove('show');
}

function salvarPerfil() {
    const descricao = document.getElementById('editDescricao').value.trim();
    
    if (descricao.length < 50) {
        showToast('error', `A descrição deve ter no mínimo 50 caracteres. Você digitou ${descricao.length} caracteres.`);
        return;
    }
    
    const formData = new FormData();
    formData.append('descricao', descricao);

    const submitBtn = document.querySelector('button[form="editProfileForm"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';

    fetch('../php/atualizar_perfil_especialista.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('success', data.message);
            closeEditModal();
            setTimeout(() => carregarDadosEspecialista(), 500);
        } else {
            showToast('error', data.message);
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        showToast('error', 'Erro ao atualizar perfil');
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    });
}

// ============= DADOS SIMULADOS (TEMPORÁRIO) =============
function carregarDadosSimulados() {
    consultas = [
        { id: 1, paciente: "Lucas Silva", data: "2025-10-20T14:00", tipo: "Presencial", status: "Confirmada", valor: 320 },
        { id: 2, paciente: "Ana Souza", data: "2025-10-22T09:30", tipo: "Online", status: "Pendente", valor: 280 },
        { id: 3, paciente: "Gabriel Lima", data: "2025-10-25T16:00", tipo: "Presencial", status: "Confirmada", valor: 320 }
    ];

    pacientes = [
        { id: 1, nome: "Gabriel Lima", dataNasc: "2016-05-12", responsavel: "Larissa Lima", telefone: "(11) 97700-1234", email: "larissa@email.com", ultimaConsulta: "2025-09-07", status: "Ativo" },
        { id: 2, nome: "Lucas Silva", dataNasc: "2014-03-20", responsavel: "Carlos Silva", telefone: "(11) 98888-5555", email: "carlos@email.com", ultimaConsulta: "2025-09-15", status: "Ativo" },
        { id: 3, nome: "Ana Souza", dataNasc: "2015-07-08", responsavel: "Fernanda Souza", telefone: "(11) 99999-3333", email: "fernanda@email.com", ultimaConsulta: "2025-09-20", status: "Ativo" }
    ];

    avaliacoes = [
        { paciente: "Lucas Silva", nota: 5, comentario: "Excelente profissional! Muito atenciosa e dedicada.", data: "2025-09-20" },
        { paciente: "Ana Souza", nota: 5, comentario: "Minha filha adorou as sessões. Recomendo!", data: "2025-09-18" },
        { paciente: "Gabriel Lima", nota: 4, comentario: "Ótimo atendimento e ambiente acolhedor.", data: "2025-09-15" }
    ];

    conteudos = [
        { id: 1, titulo: "Desenvolvimento Infantil", tipo: "Artigo", descricao: "Guia completo sobre marcos do desenvolvimento", url: "#" },
        { id: 2, titulo: "Lidando com Ansiedade", tipo: "Vídeo", descricao: "Técnicas para ajudar crianças ansiosas", url: "#" },
        { id: 3, titulo: "Rotina Saudável", tipo: "PDF", descricao: "Dicas para estabelecer rotinas", url: "#" }
    ];

    horarios = [
        { dia: "Segunda-feira", inicio: "09:00", fim: "18:00" },
        { dia: "Quarta-feira", inicio: "09:00", fim: "18:00" },
        { dia: "Sexta-feira", inicio: "09:00", fim: "16:00" }
    ];

    updateStats();
}

// ============= NAVEGAÇÃO =============
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    document.getElementById(sectionId).classList.add('active');
    
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(sectionId)) {
            item.classList.add('active');
        }
    });
    
    loadSectionData(sectionId);
    
    document.getElementById('userDropdown').classList.remove('active');
}

function loadSectionData(section) {
    switch(section) {
        case 'dashboard':
            renderDashboardConsultas();
            updateStats();
            break;
        case 'consultas':
            renderConsultas();
            break;
        case 'pacientes':
            renderPacientes();
            break;
        case 'avaliacoes':
            renderAvaliacoes();
            break;
        case 'conteudos':
            renderConteudos();
            break;
        case 'agenda':
            renderAgenda();
            break;
    }
}

// ============= DASHBOARD =============
function updateStats() {
    document.getElementById('totalConsultas').textContent = consultas.length;
    document.getElementById('totalPacientes').textContent = pacientes.length;
    const receita = consultas.reduce((sum, c) => sum + c.valor, 0);
    document.getElementById('receitaMensal').textContent = `R$ ${receita.toLocaleString('pt-BR')}`;
    document.getElementById('totalAvaliacoes').textContent = avaliacoes.length;
}

function renderDashboardConsultas() {
    const tbody = document.getElementById('dashboardConsultasTable');
    const proximasConsultas = consultas.slice(0, 3);
    
    if (proximasConsultas.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="4" style="text-align: center; padding: 2rem;">
                    <i class="fas fa-calendar-alt" style="font-size: 2rem; color: var(--text-medium); margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-medium);">Nenhuma consulta agendada</p>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = proximasConsultas.map(c => `
        <tr>
            <td>${c.paciente}</td>
            <td>${formatDateTime(c.data)}</td>
            <td>${c.tipo}</td>
            <td><span class="badge ${getStatusBadge(c.status)}">${c.status}</span></td>
        </tr>
    `).join('');
}

// ============= CONSULTAS =============
function renderConsultas() {
    const tbody = document.getElementById('consultasTable');
    const consultasFiltradas = applyFilters();
    
    if (consultasFiltradas.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7">
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Nenhuma consulta encontrada</h3>
                        <p>Adicione uma nova consulta para começar.</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = consultasFiltradas.map(c => `
        <tr>
            <td>#${c.id}</td>
            <td>${c.paciente}</td>
            <td>${formatDateTime(c.data)}</td>
            <td>${c.tipo}</td>
            <td><span class="badge ${getStatusBadge(c.status)}">${c.status}</span></td>
            <td>R$ ${c.valor}</td>
            <td>
                <button class="action-btn view" title="Ver" onclick="viewAppointment(${c.id})">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn delete" title="Excluir" onclick="deleteAppointment(${c.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

function applyFilters() {
    const status = document.getElementById('filterStatus')?.value || '';
    const tipo = document.getElementById('filterTipo')?.value || '';
    const dataInicio = document.getElementById('filterDataInicio')?.value || '';
    const dataFim = document.getElementById('filterDataFim')?.value || '';
    
    return consultas.filter(c => {
        if (status && c.status !== status) return false;
        if (tipo && c.tipo !== tipo) return false;
        if (dataInicio && new Date(c.data) < new Date(dataInicio)) return false;
        if (dataFim && new Date(c.data) > new Date(dataFim)) return false;
        return true;
    });
}

function loadPatientOptions() {
    const select = document.getElementById('consultaPaciente');
    select.innerHTML = '<option value="">Selecione um paciente</option>' +
        pacientes.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');
}

function addAppointment() {
    const pacienteId = document.getElementById('consultaPaciente').value;
    const dataHora = document.getElementById('consultaDataHora').value;
    const tipo = document.getElementById('consultaTipo').value;
    const valor = parseFloat(document.getElementById('consultaValor').value);
    
    if (!pacienteId || !dataHora) {
        showToast('error', 'Por favor, preencha todos os campos obrigatórios!');
        return;
    }
    
    const paciente = pacientes.find(p => p.id == pacienteId);
    const novaConsulta = {
        id: consultas.length + 1,
        paciente: paciente.nome,
        data: dataHora,
        tipo: tipo,
        status: "Pendente",
        valor: valor
    };
    
    consultas.push(novaConsulta);
    closeModal('addAppointmentModal');
    showToast('success', 'Consulta agendada com sucesso!');
    renderConsultas();
    updateStats();
}

function viewAppointment(id) {
    const consulta = consultas.find(c => c.id === id);
    const details = document.getElementById('appointmentDetails');
    
    details.innerHTML = `
        <div style="margin-bottom: 1rem;">
            <strong>ID:</strong> #${consulta.id}<br>
            <strong>Paciente:</strong> ${consulta.paciente}<br>
            <strong>Data/Hora:</strong> ${formatDateTime(consulta.data)}<br>
            <strong>Tipo:</strong> ${consulta.tipo}<br>
            <strong>Status:</strong> <span class="badge ${getStatusBadge(consulta.status)}">${consulta.status}</span><br>
            <strong>Valor:</strong> R$ ${consulta.valor}
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeModal('viewAppointmentModal')">
                <i class="fas fa-check"></i> OK
            </button>
        </div>
    `;
    
    showModal('viewAppointmentModal');
}

function deleteAppointment(id) {
    if (confirm('Tem certeza que deseja excluir esta consulta?')) {
        consultas = consultas.filter(c => c.id !== id);
        renderConsultas();
        updateStats();
        showToast('success', 'Consulta excluída com sucesso!');
    }
}

function exportConsultations() {
    const csv = 'ID,Paciente,Data/Hora,Tipo,Status,Valor\n' +
        consultas.map(c => `${c.id},${c.paciente},${c.data},${c.tipo},${c.status},${c.valor}`).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'consultas_export.csv';
    a.click();
    showToast('success', 'Consultas exportadas com sucesso!');
}

// ============= PACIENTES =============
function renderPacientes() {
    const tbody = document.getElementById('pacientesTable');
    
    if (pacientes.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum paciente cadastrado</h3>
                        <p>Adicione um novo paciente para começar.</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = pacientes.map(p => {
        const idade = calcularIdade(p.dataNasc);
        return `
            <tr>
                <td>#${p.id}</td>
                <td>${p.nome}</td>
                <td>${idade} anos</td>
                <td>${p.responsavel}</td>
                <td>${p.telefone}</td>
                <td>${formatDate(p.ultimaConsulta)}</td>
                <td><span class="badge ${getStatusBadge(p.status)}">${p.status}</span></td>
                <td>
                    <button class="action-btn view" title="Ver" onclick="viewPatient(${p.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn delete" title="Excluir" onclick="deletePatient(${p.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    }).join('');
}

function searchPatients() {
    const search = document.getElementById('searchPaciente').value.toLowerCase();
    const tbody = document.getElementById('pacientesTable');
    
    const filtered = pacientes.filter(p => 
        p.nome.toLowerCase().includes(search) || 
        p.responsavel.toLowerCase().includes(search)
    );
    
    if (filtered.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Nenhum paciente encontrado</h3>
                        <p>Tente buscar por outro nome.</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = filtered.map(p => {
        const idade = calcularIdade(p.dataNasc);
        return `
            <tr>
                <td>#${p.id}</td>
                <td>${p.nome}</td>
                <td>${idade} anos</td>
                <td>${p.responsavel}</td>
                <td>${p.telefone}</td>
                <td>${formatDate(p.ultimaConsulta)}</td>
                <td><span class="badge ${getStatusBadge(p.status)}">${p.status}</span></td>
                <td>
                    <button class="action-btn view" title="Ver" onclick="viewPatient(${p.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn delete" title="Excluir" onclick="deletePatient(${p.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    }).join('');
}

function addPatient() {
    const nome = document.getElementById('pacienteNome').value;
    const dataNasc = document.getElementById('pacienteDataNasc').value;
    const responsavel = document.getElementById('pacienteResponsavel').value;
    const telefone = document.getElementById('pacienteTelefone').value;
    const email = document.getElementById('pacienteEmail').value;
    
    if (!nome || !dataNasc || !responsavel || !telefone) {
        showToast('error', 'Por favor, preencha todos os campos obrigatórios!');
        return;
    }
    
    const novoPaciente = {
        id: pacientes.length + 1,
        nome: nome,
        dataNasc: dataNasc,
        responsavel: responsavel,
        telefone: telefone,
        email: email,
        ultimaConsulta: new Date().toISOString().split('T')[0],
        status: "Ativo"
    };
    
    pacientes.push(novoPaciente);
    closeModal('addPatientModal');
    showToast('success', 'Paciente cadastrado com sucesso!');
    renderPacientes();
    updateStats();
    
    // Limpar campos
    document.getElementById('pacienteNome').value = '';
    document.getElementById('pacienteDataNasc').value = '';
    document.getElementById('pacienteResponsavel').value = '';
    document.getElementById('pacienteTelefone').value = '';
    document.getElementById('pacienteEmail').value = '';
    document.getElementById('pacienteObs').value = '';
}

function viewPatient(id) {
    const paciente = pacientes.find(p => p.id === id);
    const idade = calcularIdade(paciente.dataNasc);
    const details = document.getElementById('patientDetails');
    
    details.innerHTML = `
        <div style="margin-bottom: 1rem;">
            <strong>ID:</strong> #${paciente.id}<br>
            <strong>Nome:</strong> ${paciente.nome}<br>
            <strong>Idade:</strong> ${idade} anos<br>
            <strong>Data de Nascimento:</strong> ${formatDate(paciente.dataNasc)}<br>
            <strong>Responsável:</strong> ${paciente.responsavel}<br>
            <strong>Telefone:</strong> ${paciente.telefone}<br>
            <strong>Email:</strong> ${paciente.email}<br>
            <strong>Última Consulta:</strong> ${formatDate(paciente.ultimaConsulta)}<br>
            <strong>Status:</strong> <span class="badge ${getStatusBadge(paciente.status)}">${paciente.status}</span>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeModal('viewPatientModal')">
                <i class="fas fa-check"></i> OK
            </button>
        </div>
    `;
    
    showModal('viewPatientModal');
}

function deletePatient(id) {
    if (confirm('Tem certeza que deseja remover este paciente?')) {
        pacientes = pacientes.filter(p => p.id !== id);
        renderPacientes();
        updateStats();
        showToast('success', 'Paciente removido com sucesso!');
    }
}

function exportPatients() {
    const csv = 'ID,Nome,Data Nascimento,Responsável,Telefone,Email,Última Consulta,Status\n' +
        pacientes.map(p => `${p.id},${p.nome},${p.dataNasc},${p.responsavel},${p.telefone},${p.email},${p.ultimaConsulta},${p.status}`).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'pacientes_export.csv';
    a.click();
    showToast('success', 'Pacientes exportados com sucesso!');
}

// ============= AVALIAÇÕES =============
function renderAvaliacoes() {
    const container = document.getElementById('avaliacoesContent');
    
    if (avaliacoes.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-star"></i>
                <h3>Nenhuma avaliação ainda</h3>
                <p>As avaliações dos pacientes aparecerão aqui.</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = avaliacoes.map(a => `
        <div style="padding: 1rem; border-bottom: 1px solid var(--border); margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <strong>${a.paciente}</strong>
                <div style="color: var(--warning-color);">
                    ${'★'.repeat(a.nota)}${'☆'.repeat(5-a.nota)}
                </div>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">${a.comentario}</p>
            <small style="color: var(--text-secondary);">${formatDate(a.data)}</small>
        </div>
    `).join('');
}

// ============= CONTEÚDOS =============
function renderConteudos() {
    const container = document.getElementById('conteudosGrid');
    
    if (conteudos.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-book"></i>
                <h3>Nenhum conteúdo cadastrado</h3>
                <p>Adicione materiais educativos para seus pacientes.</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
            ${conteudos.map(c => `
                <div class="stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-${getContentIcon(c.tipo)}"></i>
                    </div>
                    <h4 style="margin-bottom: 0.5rem;">${c.titulo}</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">${c.descricao}</p>
                    <span class="badge primary">${c.tipo}</span>
                    <div style="margin-top: 1rem;">
                        <button class="action-btn view" onclick="window.open('${c.url}', '_blank')">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteContent(${c.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function addContent() {
    const titulo = document.getElementById('contentTitulo').value;
    const tipo = document.getElementById('contentTipo').value;
    const descricao = document.getElementById('contentDesc').value;
    const url = document.getElementById('contentUrl').value;
    
    if (!titulo || !descricao || !url) {
        showToast('error', 'Por favor, preencha todos os campos!');
        return;
    }
    
    const novoConteudo = {
        id: conteudos.length + 1,
        titulo: titulo,
        tipo: tipo,
        descricao: descricao,
        url: url
    };
    
    conteudos.push(novoConteudo);
    closeModal('addContentModal');
    showToast('success', 'Conteúdo adicionado com sucesso!');
    renderConteudos();
    
    // Limpar campos
    document.getElementById('contentTitulo').value = '';
    document.getElementById('contentDesc').value = '';
    document.getElementById('contentUrl').value = '';
}

function deleteContent(id) {
    if (confirm('Tem certeza que deseja excluir este conteúdo?')) {
        conteudos = conteudos.filter(c => c.id !== id);
        renderConteudos();
        showToast('success', 'Conteúdo excluído com sucesso!');
    }
}

function getContentIcon(tipo) {
    const icons = {
        'Artigo': 'file-alt',
        'Vídeo': 'video',
        'PDF': 'file-pdf',
        'Link': 'link'
    };
    return icons[tipo] || 'file';
}

// ============= AGENDA =============
function renderAgenda() {
    const container = document.getElementById('agendaList');
    
    if (horarios.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-clock"></i>
                <h3>Nenhum horário configurado</h3>
                <p>Configure seus horários de atendimento.</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = horarios.map((h, index) => `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--background); border-radius: 10px; margin-bottom: 0.5rem;">
            <div>
                <strong>${h.dia}</strong><br>
                <span style="color: var(--text-secondary);">${h.inicio} - ${h.fim}</span>
            </div>
            <button class="action-btn delete" onclick="deleteHorario(${index})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');
}

function saveAgenda() {
    const dia = document.getElementById('agendaDia').value;
    const inicio = document.getElementById('agendaInicio').value;
    const fim = document.getElementById('agendaFim').value;
    
    if (!inicio || !fim) {
        showToast('error', 'Por favor, preencha os horários!');
        return;
    }
    
    const exists = horarios.findIndex(h => h.dia === dia);
    if (exists !== -1) {
        if (confirm('Já existe um horário configurado para este dia. Deseja substituir?')) {
            horarios[exists] = { dia, inicio, fim };
        } else {
            return;
        }
    } else {
        horarios.push({ dia, inicio, fim });
    }
    
    showToast('success', 'Horário configurado com sucesso!');
    renderAgenda();
}

function deleteHorario(index) {
    if (confirm('Deseja remover este horário?')) {
        horarios.splice(index, 1);
        renderAgenda();
        showToast('success', 'Horário removido com sucesso!');
    }
}

// ============= MODAIS =============
function showModal(id) {
    document.getElementById(id).classList.add('active');
    if (id === 'addAppointmentModal') {
        loadPatientOptions();
    }
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

// Fechar modal clicando fora
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('active');
        }
    });
});

// ============= USER DROPDOWN =============
function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    dropdown.classList.toggle('active');
}

document.addEventListener('click', (e) => {
    if (!e.target.closest('.user-profile')) {
        document.getElementById('userDropdown').classList.remove('active');
    }
});

// ============= FUNÇÕES AUXILIARES =============
function formatDateTime(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-BR');
}

function getStatusBadge(status) {
    const badges = {
        'Confirmada': 'success',
        'Pendente': 'warning',
        'Cancelada': 'error',
        'Ativo': 'success',
        'Inativo': 'error'
    };
    return badges[status] || 'primary';
}

function calcularIdade(dataNasc) {
    const hoje = new Date();
    const nascimento = new Date(dataNasc);
    let idade = hoje.getFullYear() - nascimento.getFullYear();
    const mes = hoje.getMonth() - nascimento.getMonth();
    if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
    }
    return idade;
}

function formatarCPF(cpf) {
    if (!cpf) return '';
    cpf = cpf.replace(/\D/g, '');
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}

function showToast(type, message) {
    const toast = document.getElementById('toast');
    if (!toast) {
        alert(`[${type}] ${message}`);
        return;
    }
    
    const toastMessage = document.getElementById('toastMessage');
    const icon = toast.querySelector('i');
    
    toast.classList.remove('success', 'error', 'show');
    
    if (type === 'success') {
        toast.classList.add('success');
        if (icon) icon.className = 'fas fa-check-circle';
    } else {
        toast.classList.add('error');
        if (icon) icon.className = 'fas fa-exclamation-circle';
    }
    
    if (toastMessage) {
        toastMessage.textContent = message;
    }
    
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Fecha modal de perfil ao clicar fora
const editModal = document.getElementById('editModal');
if (editModal) {
    editModal.addEventListener('click', function(e) {
        if (e.target === this) {
            closeEditModal();
        }
    });
}

// Adiciona animação de shake
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>