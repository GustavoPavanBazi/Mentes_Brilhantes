<?php
include "conexao.php";

// Recebe os dados do formulário
$email = $_POST["email"];
$senha = $_POST["senha"];

// Variáveis para controlar o resultado do login
$usuario_encontrado = false;
$dados_usuario = null;
$tipo_usuario = "";

// Verifica na tabela cad_responsavel
$select_responsavel = "SELECT * FROM cad_responsavel WHERE email = '$email' AND senha = '$senha'";
$result_responsavel = $sql->query($select_responsavel);

if ($result_responsavel->num_rows > 0) {
    $usuario_encontrado = true;
    $dados_usuario = $result_responsavel->fetch_assoc();
    $tipo_usuario = "responsavel";
}


// Se não encontrou no neurodivergente, verifica na tabela cad_especialista
if (!$usuario_encontrado) {
    $select_especialista = "SELECT * FROM cad_especialista WHERE email = '$email' AND senha = '$senha'";
    $result_especialista = $sql->query($select_especialista);
    
    if ($result_especialista->num_rows > 0) {
        $especialista = $result_especialista->fetch_assoc();
        $usuario_encontrado = true;
        $dados_usuario = $especialista;
        $tipo_usuario = "especialista";
    }
}

// Processa o resultado do login
if ($usuario_encontrado) {
    // Inicia a sessão para manter o usuário logado
    session_start();
    
    // Salva os dados do usuário na sessão
    $_SESSION['usuario_logado'] = true;
    $_SESSION['tipo_usuario'] = $tipo_usuario;
    $_SESSION['dados_usuario'] = $dados_usuario;
    $_SESSION['email'] = $email;
    $_SESSION['nome'] = $dados_usuario['nome'];
    
    // Define o ID do usuário baseado no tipo
    switch ($tipo_usuario) {
        case 'responsavel':
            $_SESSION['id_usuario'] = $dados_usuario['id_responsa'];
            break;
        case 'especialista':
            $_SESSION['id_usuario'] = $dados_usuario['id_especial'];
            break;
    }
    
    // Redireciona baseado no tipo de usuário
    // colocar caminho da tela no header: "Location: ../xxx.php".
    switch ($tipo_usuario) {
        case 'responsavel':
            header("Location:../html/adm_responsavel.html");
            break;
        case 'especialista':
            header("Location: ../html/adm_especialista.html");
            break;
    }
    
    exit();
    
} else {
    // Opcional: redirecionar de volta para a página de login
     header("Location: ../html/login.html");
     exit();
}
?>
