<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo | Mentes Brilhantes</title>
    <link rel="stylesheet" href="../css/adm.css">
    <link rel="icon" type="image/x-icon" href="../img/LogoMB.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="../img/LogoMB.png" alt="Logo Mentes Brilhantes" style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius-md);">
                    </div>
                    <div class="logo-text">
                        <h1>Mentes Brilhantes</h1>
                        <p>Centro de Apoio Especializado</p>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                            <i class="fas fa-chart-line"></i>
                            Dashboard
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('responsaveis')">
                            <i class="fas fa-users"></i>
                            Famílias Cadastradas
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('especialistas')">
                            <i class="fas fa-user-md"></i>
                            Solicitações de Parceria
                            <span class="nav-badge">1</span>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Configurações</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('configuracoes')">
                            <i class="fas fa-cog"></i>
                            Configurações
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard">
                <div class="page-header">
                    <h1 class="page-title">Visão Geral do Sistema</h1>
                    <p class="page-description">Acompanhe as métricas principais da plataforma e monitore o crescimento da comunidade Mentes Brilhantes.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon heart">
                                <i class="fas fa-heart"></i>
                            </div>
                        </div>
                        <div class="stat-value">152</div>
                        <div class="stat-label">Pessoas Autistas Atendidas</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            12 novos cadastros este mês
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-value">94</div>
                        <div class="stat-label">Famílias Ativas</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            7 novas famílias esta semana
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon doctors">
                                <i class="fas fa-user-md"></i>
                            </div>
                        </div>
                        <div class="stat-value">28</div>
                        <div class="stat-label">Especialistas Parceiros</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            4 aprovações recentes
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-value">1</div>
                        <div class="stat-label">Solicitações Pendentes</div>
                        <div class="stat-trend warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Aguardando análise
                        </div>
                    </div>
                </div>
            </div>

            <!-- Responsáveis Section -->
            <div class="content-section" id="responsaveis">
                <div class="page-header">
                    <h1 class="page-title">Famílias Cadastradas</h1>
                    <p class="page-description">Gerencie as famílias registradas na plataforma e acesse informações dos autistas vinculados a cada responsável.</p>
                </div>

                <div class="data-card">
                    <div class="data-card-header">
                        <h2 class="data-card-title">Lista de Responsáveis</h2>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="Buscar por nome, email, telefone ou autista...">
                            <button class="search-clear" id="clearSearch" title="Limpar busca">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="search-results-count" id="searchResultsCount"></div>
                    
                    <!-- Desktop Table View -->
                    <div class="desktop-view">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Responsável</th>
                                    <th>Contato</th>
                                    <th>Autistas Vinculados</th>
                                    <th>Data de Cadastro</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="responsaveisTable">
                                <tr class="clickable" onclick="viewAutistas('Maria Silva Santos', 'maria-silva')">
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar">MS</div>
                                            <div class="user-details">
                                                <h4>Maria Silva Santos</h4>
                                                <p>Mãe e Cuidadora Principal</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>maria.silva@gmail.com</div>
                                        <div style="color: #64748b; font-size: 0.8rem;">(11) 99876-5432</div>
                                    </td>
                                    <td>
                                        <span style="font-weight: 600; color: #3730a3;">2 pessoas</span>
                                        <div style="font-size: 0.8rem; color: #64748b;">Gabriel (8 anos), Ana (12 anos)</div>
                                    </td>
                                    <td>22/05/2025</td>
                                    <td><span class="status-badge status-active">Ativo</span></td>
                                    <td>
                                        <button class="btn btn-secondary btn-sm">
                                            <i class="fas fa-edit"></i>
                                            Editar
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Mobile Card View -->
                    <div class="mobile-view">
                        <div class="mobile-cards" id="mobileResponsaveis">
                            <div class="mobile-card clickable" onclick="viewAutistas('Maria Silva Santos', 'maria-silva')">
                                <div class="mobile-card-header">
                                    <div class="user-info">
                                        <div class="user-avatar">MS</div>
                                        <div class="user-details">
                                            <h4>Maria Silva Santos</h4>
                                            <p>Mãe e Cuidadora Principal</p>
                                        </div>
                                    </div>
                                    <span class="status-badge status-active">Ativo</span>
                                </div>
                                <div class="mobile-card-body">
                                    <div class="mobile-info-item">
                                        <i class="fas fa-envelope"></i>
                                        <span>maria.silva@gmail.com</span>
                                    </div>
                                    <div class="mobile-info-item">
                                        <i class="fas fa-phone"></i>
                                        <span>(11) 99876-5432</span>
                                    </div>
                                    <div class="mobile-info-item">
                                        <i class="fas fa-users"></i>
                                        <span>2 pessoas: Gabriel (8 anos), Ana (12 anos)</span>
                                    </div>
                                    <div class="mobile-info-item">
                                        <i class="fas fa-calendar"></i>
                                        <span>Cadastrado em 22/05/2025</span>
                                    </div>
                                </div>
                                <div class="mobile-card-actions">
                                    <button class="btn btn-secondary btn-sm">
                                        <i class="fas fa-edit"></i>
                                        Editar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="no-results" id="noResults">
                        <i class="fas fa-search"></i>
                        <h3>Nenhum resultado encontrado</h3>
                        <p>Tente buscar com outros termos ou verifique a ortografia.</p>
                    </div>
                </div>
            </div>

            <!-- Especialistas Section -->
            <div class="content-section" id="especialistas">
                <div class="page-header">
                    <h1 class="page-title">Solicitações de Parceria</h1>
                    <p class="page-description">Analise e aprove pedidos de especialistas interessados em fazer parte da rede de parceiros da Mentes Brilhantes.</p>
                </div>

                <div class="requests-grid">
                    <div class="request-card">
                        <div class="request-header">
                            <div class="request-avatar">MF</div>
                            <div class="request-info">
                                <h3>Dra. Marina Fernandes</h3>
                                <p>Psicóloga Clínica Especializada</p>
                                <p><i class="fas fa-envelope"></i> marina.fernandes@clinicaespecializada.com.br</p>
                                <p><i class="fas fa-phone"></i> (11) 3456-7890</p>
                            </div>
                        </div>
                        <div class="request-specialization">
                            <h4>Área de Especialização</h4>
                            <p>Especialista em Transtorno do Espectro Autista com 15 anos de experiência clínica. Mestre em Psicologia do Desenvolvimento pela USP com foco em terapias comportamentais para crianças e adolescentes autistas. Atualmente coordena um centro de referência em TEA na zona sul de São Paulo.</p>
                        </div>
                        <div class="request-actions">
                            <button class="btn btn-success btn-sm" onclick="approveRequest(this, 'Dra. Marina Fernandes')">
                                <i class="fas fa-check"></i>
                                Aprovar Parceria
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="rejectRequest(this, 'Dra. Marina Fernandes')">
                                <i class="fas fa-times"></i>
                                Recusar
                            </button>
                            <button class="btn btn-secondary btn-sm">
                                <i class="fas fa-file-alt"></i>
                                Ver Documentos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configurações Section -->
            <div class="content-section" id="configuracoes">
                <div class="page-header">
                    <h1 class="page-title">Configurações do Sistema</h1>
                    <p class="page-description">Gerencie configurações avançadas do sistema, personalize sua experiência e controle recursos administrativos.</p>
                </div>

                <div class="settings-grid">
                    <!-- Aparência -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Aparência e Interface</h3>
                                <p>Personalize o visual e comportamento da interface</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-item">
                                <label class="setting-label">Tema da Interface</label>
                                <div class="theme-selector">
                                    <button class="theme-option active" data-theme="dark" onclick="setTheme('dark')">
                                        <div class="theme-preview dark-preview"></div>
                                        <span>Escuro</span>
                                    </button>
                                    <button class="theme-option" data-theme="light" onclick="setTheme('light')">
                                        <div class="theme-preview light-preview"></div>
                                        <span>Claro</span>
                                    </button>
                                    <button class="theme-option" data-theme="auto" onclick="setTheme('auto')">
                                        <div class="theme-preview auto-preview"></div>
                                        <span>Automático</span>
                                    </button>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label">Densidade da Interface</label>
                                <select class="setting-select" id="interfaceDensity" onchange="setDensity(this.value)">
                                    <option value="comfortable">Confortável (Padrão)</option>
                                    <option value="compact">Compacta</option>
                                    <option value="spacious">Espaçosa</option>
                                </select>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="animationsEnabled" checked onchange="toggleAnimations(this.checked)">
                                <label for="animationsEnabled">Ativar animações da interface</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="sidebarCollapsed" onchange="toggleSidebarDefault(this.checked)">
                                <label for="sidebarCollapsed">Manter menu lateral recolhido por padrão</label>
                            </div>
                        </div>
                    </div>

                    <!-- Notificações -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon" style="background: var(--warning-gradient);">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Notificações</h3>
                                <p>Configure alertas e notificações do sistema</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-toggle">
                                <input type="checkbox" id="desktopNotifications" checked onchange="updateNotificationSetting('desktop', this.checked)">
                                <label for="desktopNotifications">Notificações desktop do navegador</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="emailNotifications" checked onchange="updateNotificationSetting('email', this.checked)">
                                <label for="emailNotifications">Notificações por email</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="newRegistrations" checked onchange="updateNotificationSetting('registrations', this.checked)">
                                <label for="newRegistrations">Novos cadastros de famílias</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="partnershipRequests" checked onchange="updateNotificationSetting('partnerships', this.checked)">
                                <label for="partnershipRequests">Solicitações de parceria</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="systemAlerts" checked onchange="updateNotificationSetting('system', this.checked)">
                                <label for="systemAlerts">Alertas de sistema e segurança</label>
                            </div>
                        </div>
                    </div>

                    <!-- Privacidade e Segurança -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon" style="background: var(--success-gradient);">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Privacidade e Segurança</h3>
                                <p>Gerencie configurações de segurança e privacidade</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-item">
                                <label class="setting-label">Tempo limite de sessão</label>
                                <select class="setting-select" id="sessionTimeout" onchange="updateSessionTimeout(this.value)">
                                    <option value="30">30 minutos</option>
                                    <option value="60" selected>1 hora</option>
                                    <option value="120">2 horas</option>
                                    <option value="240">4 horas</option>
                                    <option value="480">8 horas</option>
                                </select>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="twoFactorAuth" onchange="toggleTwoFactor(this.checked)">
                                <label for="twoFactorAuth">Autenticação de dois fatores (2FA)</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="loginAlerts" checked onchange="updateSecuritySetting('loginAlerts', this.checked)">
                                <label for="loginAlerts">Alertas de login em novos dispositivos</label>
                            </div>
                            <div class="setting-item">
                                <button class="btn btn-secondary btn-sm" onclick="showPasswordChangeModal()">
                                    <i class="fas fa-key"></i>
                                    Alterar Senha
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Dados e Exportação -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon" style="background: var(--secondary-gradient);">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Dados e Relatórios</h3>
                                <p>Exporte dados e configure relatórios automáticos</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-item">
                                <label class="setting-label">Relatórios automáticos</label>
                                <select class="setting-select" id="autoReports" onchange="updateAutoReports(this.value)">
                                    <option value="disabled">Desativado</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensal</option>
                                    <option value="quarterly">Trimestral</option>
                                </select>
                            </div>
                            <div class="setting-actions-group">
                                <button class="btn btn-secondary btn-sm" onclick="exportData('families')">
                                    <i class="fas fa-users"></i>
                                    Exportar Famílias
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="exportData('specialists')">
                                    <i class="fas fa-user-md"></i>
                                    Exportar Especialistas
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="exportData('complete')">
                                    <i class="fas fa-file-export"></i>
                                    Relatório Completo
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Sistema e Performance -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon" style="background: var(--accent-gradient);">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Sistema e Performance</h3>
                                <p>Configurações avançadas do sistema</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-item">
                                <label class="setting-label">Itens por página</label>
                                <select class="setting-select" id="itemsPerPage" onchange="updatePagination(this.value)">
                                    <option value="10">10 itens</option>
                                    <option value="25" selected>25 itens</option>
                                    <option value="50">50 itens</option>
                                    <option value="100">100 itens</option>
                                </select>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh(this.checked)">
                                <label for="autoRefresh">Atualização automática de dados (5 min)</label>
                            </div>
                            <div class="setting-toggle">
                                <input type="checkbox" id="cacheEnabled" checked onchange="toggleCache(this.checked)">
                                <label for="cacheEnabled">Cache local para melhor performance</label>
                            </div>
                            <div class="setting-item">
                                <button class="btn btn-secondary btn-sm" onclick="clearCache()">
                                    <i class="fas fa-trash-alt"></i>
                                    Limpar Cache Local
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Backup e Manutenção -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon" style="background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="setting-info">
                                <h3>Backup e Manutenção</h3>
                                <p>Configurações de backup e manutenção do sistema</p>
                            </div>
                        </div>
                        <div class="setting-content">
                            <div class="setting-item">
                                <label class="setting-label">Backup automático</label>
                                <select class="setting-select" id="autoBackup" onchange="updateBackupSettings(this.value)">
                                    <option value="disabled">Desativado</option>
                                    <option value="daily" selected>Diário</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly">Mensal</option>
                                </select>
                            </div>
                            <div class="setting-actions-group">
                                <button class="btn btn-success btn-sm" onclick="createBackup()">
                                    <i class="fas fa-save"></i>
                                    Criar Backup Manual
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="showMaintenanceMode()">
                                    <i class="fas fa-tools"></i>
                                    Modo Manutenção
                                </button>
                            </div>
                            <div class="backup-info">
                                <p>Último backup: <strong>10/09/2025 às 03:00</strong></p>
                                <p>Próximo backup: <strong>11/09/2025 às 03:00</strong></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ações de Configuração -->
                <div class="settings-actions">
                    <button class="btn btn-success" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i>
                        Salvar Todas as Configurações
                    </button>
                    <button class="btn btn-secondary" onclick="exportSettings()">
                        <i class="fas fa-file-export"></i>
                        Exportar Configurações
                    </button>
                    <button class="btn btn-secondary" onclick="importSettings()">
                        <i class="fas fa-file-import"></i>
                        Importar Configurações
                    </button>
                    <button class="btn btn-danger" onclick="resetAllSettings()">
                        <i class="fas fa-undo"></i>
                        Restaurar Padrões
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Autistas Details -->
    <div class="modal" id="autistasModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Autistas Vinculados</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="autistasContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Sample data for autistas
        const autistasData = {
            'maria-silva': [
                {
                    name: 'Gabriel Santos Silva',
                    age: '8 anos',
                    supportLevel: 'Nível 1 de Suporte',
                    diagnosis: 'TEA - Síndrome de Asperger',
                    therapies: 'Psicologia, Fonoaudiologia',
                    school: 'Escola Inclusiva São Paulo',
                    interests: 'Matemática, Robótica, Astronomia',
                    registerDate: '15/07/2025'
                },
                {
                    name: 'Ana Beatriz Santos Silva',
                    age: '12 anos',
                    supportLevel: 'Nível 2 de Suporte',
                    diagnosis: 'TEA com Déficit Intelectual Leve',
                    therapies: 'Psicologia, Terapia Ocupacional, ABA',
                    school: 'APAE São Paulo',
                    interests: 'Desenho, Música, Dança',
                    registerDate: '15/07/2025'
                }
            ]
        };

        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');
            
            if (window.innerWidth <= 1024 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target) && 
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });

        // Theme Management
        function setTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            
            if (theme === 'light') {
                document.body.classList.add('light-theme');
                document.body.classList.remove('dark-theme');
            } else if (theme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
            } else if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    document.body.classList.remove('light-theme');
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.add('light-theme');
                    document.body.classList.remove('dark-theme');
                }
            }
            
            showNotification(`Tema alterado para ${theme === 'light' ? 'claro' : theme === 'dark' ? 'escuro' : 'automático'}`, 'success');
        }

        // Enhanced Settings Functions
        function setDensity(density) {
            document.body.setAttribute('data-density', density);
            showNotification(`Densidade da interface alterada para ${density === 'comfortable' ? 'confortável' : density === 'compact' ? 'compacta' : 'espaçosa'}`, 'success');
        }

        function toggleAnimations(enabled) {
            document.body.classList.toggle('no-animations', !enabled);
            showNotification(`Animações ${enabled ? 'ativadas' : 'desativadas'}`, 'success');
        }

        function toggleSidebarDefault(collapsed) {
            const setting = collapsed ? 'recolhido' : 'expandido';
            showNotification(`Menu lateral configurado para iniciar ${setting}`, 'success');
        }

        function updateNotificationSetting(type, enabled) {
            const settings = {
                desktop: 'Notificações desktop',
                email: 'Notificações por email',
                registrations: 'Alertas de novos cadastros',
                partnerships: 'Alertas de solicitações de parceria',
                system: 'Alertas de sistema'
            };
            
            if (type === 'desktop' && enabled && 'Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            showNotification(`${settings[type]} ${enabled ? 'ativadas' : 'desativadas'}`, 'success');
        }

        function updateSessionTimeout(minutes) {
            const hours = minutes >= 60 ? `${minutes / 60} hora${minutes > 60 ? 's' : ''}` : `${minutes} minutos`;
            showNotification(`Tempo limite de sessão alterado para ${hours}`, 'success');
        }

        function toggleTwoFactor(enabled) {
            if (enabled) {
                showNotification('Autenticação de dois fatores será configurada. Você receberá instruções por email.', 'success');
            } else {
                if (confirm('Tem certeza que deseja desativar a autenticação de dois fatores? Isso pode reduzir a segurança da sua conta.')) {
                    showNotification('Autenticação de dois fatores desativada', 'success');
                } else {
                    document.getElementById('twoFactorAuth').checked = true;
                }
            }
        }

        function updateSecuritySetting(type, enabled) {
            const settings = {
                loginAlerts: 'Alertas de login em novos dispositivos'
            };
            showNotification(`${settings[type]} ${enabled ? 'ativados' : 'desativados'}`, 'success');
        }

        function showPasswordChangeModal() {
            const modal = document.getElementById('autistasModal');
            const modalTitle = document.getElementById('modalTitle');
            const autistasContent = document.getElementById('autistasContent');
            
            modalTitle.textContent = 'Alterar Senha';
            autistasContent.innerHTML = `
                <div style="max-width: 400px; margin: 0 auto;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Senha atual</label>
                        <input type="password" id="currentPassword" style="width: 100%; padding: 0.75rem; background: var(--surface-primary); border: 1px solid var(--border-secondary); border-radius: var(--radius-md); color: var(--text-primary);" placeholder="Digite sua senha atual">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Nova senha</label>
                        <input type="password" id="newPassword" style="width: 100%; padding: 0.75rem; background: var(--surface-primary); border: 1px solid var(--border-secondary); border-radius: var(--radius-md); color: var(--text-primary);" placeholder="Digite a nova senha">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Confirmar nova senha</label>
                        <input type="password" id="confirmPassword" style="width: 100%; padding: 0.75rem; background: var(--surface-primary); border: 1px solid var(--border-secondary); border-radius: var(--radius-md); color: var(--text-primary);" placeholder="Confirme a nova senha">
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="changePassword()" style="flex: 1;">Alterar Senha</button>
                        <button class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">Cancelar</button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showNotification('As senhas não coincidem', 'error');
                return;
            }
            
            if (newPass.length < 8) {
                showNotification('A nova senha deve ter pelo menos 8 caracteres', 'error');
                return;
            }
            
            closeModal();
            showNotification('Senha alterada com sucesso!', 'success');
        }

        function updateAutoReports(frequency) {
            const frequencies = {
                disabled: 'desativados',
                weekly: 'semanais',
                monthly: 'mensais',
                quarterly: 'trimestrais'
            };
            showNotification(`Relatórios automáticos configurados como ${frequencies[frequency]}`, 'success');
        }

        function exportData(type) {
            const types = {
                families: 'dados das famílias',
                specialists: 'dados dos especialistas',
                complete: 'relatório completo'
            };
            
            showNotification(`Exportando ${types[type]}... O download iniciará em breve.`, 'success');
            
            // Simulate file download
            setTimeout(() => {
                showNotification(`Exportação de ${types[type]} concluída!`, 'success');
            }, 2000);
        }

        function updatePagination(itemsPerPage) {
            showNotification(`Paginação alterada para ${itemsPerPage} itens por página`, 'success');
        }

        function toggleAutoRefresh(enabled) {
            showNotification(`Atualização automática ${enabled ? 'ativada' : 'desativada'}`, 'success');
        }

        function toggleCache(enabled) {
            showNotification(`Cache local ${enabled ? 'ativado' : 'desativado'}`, 'success');
        }

        function clearCache() {
            if (confirm('Tem certeza que deseja limpar o cache local? Isso pode afetar temporariamente a performance.')) {
                showNotification('Cache local limpo com sucesso!', 'success');
            }
        }

        function updateBackupSettings(frequency) {
            const frequencies = {
                disabled: 'desativado',
                daily: 'diário',
                weekly: 'semanal',
                monthly: 'mensal'
            };
            showNotification(`Backup automático configurado como ${frequencies[frequency]}`, 'success');
        }

        function createBackup() {
            if (confirm('Criar um backup manual do sistema? Este processo pode levar alguns minutos.')) {
                showNotification('Criando backup manual... Isso pode levar alguns minutos.', 'success');
                
                setTimeout(() => {
                    showNotification('Backup manual criado com sucesso!', 'success');
                    // Update backup info
                    const backupInfo = document.querySelector('.backup-info');
                    if (backupInfo) {
                        const now = new Date();
                        const dateStr = now.toLocaleDateString('pt-BR');
                        const timeStr = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                        backupInfo.innerHTML = `
                            <p>Último backup: <strong>${dateStr} às ${timeStr}</strong></p>
                            <p>Próximo backup: <strong>11/09/2025 às 03:00</strong></p>
                        `;
                    }
                }, 3000);
            }
        }

        function showMaintenanceMode() {
            if (confirm('Ativar modo de manutenção? Isso tornará o sistema temporariamente inacessível para usuários.')) {
                showNotification('Modo de manutenção ativado. O sistema está temporariamente indisponível.', 'success');
            }
        }

        function saveAllSettings() {
            showNotification('Salvando todas as configurações...', 'success');
            
            setTimeout(() => {
                showNotification('Todas as configurações foram salvas com sucesso!', 'success');
            }, 1500);
        }

        function exportSettings() {
            showNotification('Exportando configurações... O arquivo será baixado em breve.', 'success');
            
            setTimeout(() => {
                showNotification('Configurações exportadas com sucesso!', 'success');
            }, 1000);
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (confirm(`Importar configurações do arquivo "${file.name}"? Isso substituirá as configurações atuais.`)) {
                        showNotification('Importando configurações...', 'success');
                        setTimeout(() => {
                            showNotification('Configurações importadas com sucesso!', 'success');
                        }, 1500);
                    }
                }
            };
            input.click();
        }

        function resetAllSettings() {
            if (confirm('Tem certeza que deseja restaurar TODAS as configurações para os valores padrão? Esta ação não pode ser desfeita.')) {
                showNotification('Restaurando todas as configurações...', 'success');
                
                // Reset all form elements to default values
                setTimeout(() => {
                    document.getElementById('interfaceDensity').value = 'comfortable';
                    document.getElementById('animationsEnabled').checked = true;
                    document.getElementById('sidebarCollapsed').checked = false;
                    document.getElementById('desktopNotifications').checked = true;
                    document.getElementById('emailNotifications').checked = true;
                    document.getElementById('newRegistrations').checked = true;
                    document.getElementById('partnershipRequests').checked = true;
                    document.getElementById('systemAlerts').checked = true;
                    document.getElementById('sessionTimeout').value = '60';
                    document.getElementById('twoFactorAuth').checked = false;
                    document.getElementById('loginAlerts').checked = true;
                    document.getElementById('autoReports').value = 'monthly';
                    document.getElementById('itemsPerPage').value = '25';
                    document.getElementById('autoRefresh').checked = false;
                    document.getElementById('cacheEnabled').checked = true;
                    document.getElementById('autoBackup').value = 'daily';
                    
                    // Reset theme
                    document.querySelectorAll('.theme-option').forEach(option => {
                        option.classList.remove('active');
                    });
                    document.querySelector('[data-theme="dark"]').classList.add('active');
                    
                    showNotification('Todas as configurações foram restauradas para os padrões!', 'success');
                }, 1000);
            }
        }

        // Enhanced search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearButton = document.getElementById('clearSearch');
            const resultsCount = document.getElementById('searchResultsCount');
            const noResults = document.getElementById('noResults');
            const tableRows = document.querySelectorAll('#responsaveisTable tr');
            const mobileCards = document.querySelectorAll('.mobile-card');
            
            const originalRowsCount = tableRows.length;

            function performSearch(searchTerm) {
                searchTerm = searchTerm.toLowerCase().trim();
                let visibleCount = 0;
                
                if (searchTerm === '') {
                    // Show all rows and cards when search is empty
                    tableRows.forEach(row => {
                        row.classList.remove('hidden');
                        visibleCount++;
                    });
                    mobileCards.forEach(card => {
                        card.classList.remove('hidden');
                    });
                    resultsCount.textContent = '';
                    noResults.style.display = 'none';
                    clearButton.style.display = 'none';
                } else {
                    // Filter rows and cards based on search term
                    tableRows.forEach(row => {
                        const searchableText = extractSearchableText(row);
                        if (searchableText.includes(searchTerm)) {
                            row.classList.remove('hidden');
                            visibleCount++;
                        } else {
                            row.classList.add('hidden');
                        }
                    });

                    mobileCards.forEach(card => {
                        const searchableText = extractMobileSearchableText(card);
                        if (searchableText.includes(searchTerm)) {
                            card.classList.remove('hidden');
                        } else {
                            card.classList.add('hidden');
                        }
                    });
                    
                    updateSearchResults(visibleCount, originalRowsCount, searchTerm);
                    clearButton.style.display = 'block';
                }
            }

            function extractSearchableText(row) {
                const responsibleName = row.querySelector('.user-details h4')?.textContent || '';
                const responsibleRole = row.querySelector('.user-details p')?.textContent || '';
                const email = row.querySelector('td:nth-child(2) div:first-child')?.textContent || '';
                const phone = row.querySelector('td:nth-child(2) div:last-child')?.textContent || '';
                const autistasInfo = row.querySelector('td:nth-child(3) div:last-child')?.textContent || '';
                const registerDate = row.querySelector('td:nth-child(4)')?.textContent || '';
                const status = row.querySelector('.status-badge')?.textContent || '';
                
                return [
                    responsibleName,
                    responsibleRole,
                    email,
                    phone,
                    autistasInfo,
                    registerDate,
                    status
                ].join(' ').toLowerCase();
            }

            function extractMobileSearchableText(card) {
                const responsibleName = card.querySelector('.user-details h4')?.textContent || '';
                const responsibleRole = card.querySelector('.user-details p')?.textContent || '';
                const infoItems = Array.from(card.querySelectorAll('.mobile-info-item span')).map(item => item.textContent);
                const status = card.querySelector('.status-badge')?.textContent || '';
                
                return [responsibleName, responsibleRole, ...infoItems, status].join(' ').toLowerCase();
            }

            function updateSearchResults(visibleCount, totalCount, searchTerm) {
                const resultsCount = document.getElementById('searchResultsCount');
                const noResults = document.getElementById('noResults');
                
                if (visibleCount === 0) {
                    resultsCount.textContent = `Nenhum resultado encontrado para "${searchTerm}"`;
                    noResults.style.display = 'block';
                } else if (visibleCount === totalCount) {
                    resultsCount.textContent = '';
                    noResults.style.display = 'none';
                } else {
                    resultsCount.textContent = `Encontrado${visibleCount === 1 ? '' : 's'} ${visibleCount} resultado${visibleCount === 1 ? '' : 's'} de ${totalCount} para "${searchTerm}"`;
                    noResults.style.display = 'none';
                }
            }

            function clearSearch() {
                searchInput.value = '';
                performSearch('');
                searchInput.focus();
            }

            searchInput.addEventListener('input', (e) => {
                performSearch(e.target.value);
            });

            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    clearSearch();
                }
            });

            clearButton.addEventListener('click', clearSearch);

            performSearch('');
        }

        // Core functionality
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Close sidebar on mobile when navigating
            if (window.innerWidth <= 1024) {
                document.getElementById('sidebar').classList.remove('open');
            }

            if (sectionId === 'responsaveis') {
                setTimeout(initializeSearch, 100);
            }
        }

        function viewAutistas(responsibleName, responsibleId) {
            const modal = document.getElementById('autistasModal');
            const modalTitle = document.getElementById('modalTitle');
            const autistasContent = document.getElementById('autistasContent');
            modalTitle.textContent = `Autistas vinculados a ${responsibleName}`;
            const autistas = autistasData[responsibleId] || [];
            
            autistasContent.innerHTML = autistas.length === 0 
                ? '<p>Nenhum autista cadastrado para este responsável.</p>'
                : `<div class="autista-grid">${autistas.map(autista => `
                    <div class="autista-card">
                        <h4>${autista.name}</h4>
                        <div class="autista-info"><strong>Idade:</strong> ${autista.age}</div>
                        <div class="autista-info"><strong>Nível:</strong> ${autista.supportLevel}</div>
                        <div class="autista-info"><strong>Diagnóstico:</strong> ${autista.diagnosis}</div>
                        <div class="autista-info"><strong>Terapias:</strong> ${autista.therapies}</div>
                        <div class="autista-info"><strong>Escola:</strong> ${autista.school}</div>
                        <div class="autista-info"><strong>Interesses:</strong> ${autista.interests}</div>
                        <div class="autista-info"><strong>Cadastrado em:</strong> ${autista.registerDate}</div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary btn-sm">
                                <i class="fas fa-edit"></i> Editar Perfil
                            </button>
                        </div>
                    </div>
                `).join('')}</div>`;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('autistasModal').classList.remove('active');
        }

        function approveRequest(button, specialistName) {
            if (confirm(`Confirma a aprovação da solicitação de parceria de ${specialistName}?`)) {
                const card = button.closest('.request-card');
                card.style.borderLeftColor = '#10b981';
                card.style.backgroundColor = '#f0fdf4';
                card.querySelector('.request-actions').innerHTML = '<span class="status-badge status-active"><i class="fas fa-check-circle"></i> Parceria Aprovada</span>';
                showNotification(`${specialistName} foi aprovado(a) como especialista parceiro!`, 'success');
                updateBadge(-1);
            }
        }

        function rejectRequest(button, specialistName) {
            if (confirm(`Tem certeza que deseja recusar a solicitação de ${specialistName}?`)) {
                const card = button.closest('.request-card');
                card.style.borderLeftColor = '#ef4444';
                card.style.backgroundColor = '#fef2f2';
                card.querySelector('.request-actions').innerHTML = '<span class="status-badge status-inactive"><i class="fas fa-times-circle"></i> Solicitação Recusada</span>';
                showNotification(`Solicitação de ${specialistName} foi recusada.`, 'error');
                updateBadge(-1);
            }
        }

        function updateBadge(change) {
            const badge = document.querySelector('.nav-badge');
            const newCount = Math.max(0, parseInt(badge.textContent) + change);
            badge.textContent = newCount;
            if (newCount === 0) badge.style.display = 'none';
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-radius: 12px; color: white; font-weight: 500; z-index: 10000; opacity: 0; transform: translateX(100%); transition: all 0.3s ease; max-width: 400px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); ${type === 'success' ? 'background: linear-gradient(135deg, #10b981, #059669);' : 'background: linear-gradient(135deg, #ef4444, #dc2626);'}`;
            notification.innerHTML = `<div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i><span>${message}</span></div>`;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.contains(notification) && document.body.removeChild(notification), 300);
            }, 4000);
        }

        // Event listeners
        document.getElementById('autistasModal').addEventListener('click', e => e.target === e.currentTarget && closeModal());

        // Initialize search on page load if responsaveis section is active
        document.addEventListener('DOMContentLoaded', () => {
            const responsaveisSection = document.getElementById('responsaveis');
            if (responsaveisSection.classList.contains('active')) {
                initializeSearch();
            }
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                document.getElementById('sidebar').classList.remove('open');
            }
        });
    </script>
</body>
</html>
